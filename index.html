<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒãƒƒãƒ”ãƒ¼ ã‚­ãƒ£ãƒƒãƒˆ ãƒãƒ«ãƒ¼ãƒ³ ã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼ EX</title>
  <style>
    /* å…¨ä½“èƒŒæ™¯ï¼šæŸ”ã‚‰ã‹ã„ãƒ‘ã‚¹ãƒ†ãƒ«ã‚«ãƒ©ãƒ¼ã®ãƒ©ã‚¸ã‚¢ãƒ«ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
    body {
      background: radial-gradient(circle at top, #FFDEE9, #B5FFFC);
      margin: 0;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      text-align: center;
      user-select: none;
      position: relative;
      overflow: hidden;
    }
    /* ã‚²ãƒ¼ãƒ å…¨ä½“ã®ã‚³ãƒ³ãƒ†ãƒŠ */
    #game-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      position: relative;
      z-index: 1;
    }
    /* çŒ«ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆã‚µã‚¤ã‚ºã‚¢ãƒƒãƒ—ï¼†ãƒ‡ã‚£ãƒ†ãƒ¼ãƒ«å¼·åŒ–ï¼‰ */
    #character-container {
      margin: 0 auto;
      width: 250px;
      height: 250px;
      transition: transform 0.3s ease;
    }
    #character-container svg {
      width: 100%;
      height: 100%;
    }
    /* è¸Šã‚‹çŒ«ï¼šCSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§ãƒªã‚ºãƒŸã‚«ãƒ«ã«å‹•ã */
    #character-container.dancing {
      animation: dance 1s infinite;
    }
    @keyframes dance {
      0%   { transform: translateY(0) rotate(0deg); }
      25%  { transform: translateY(-15px) rotate(-5deg); }
      50%  { transform: translateY(0) rotate(0deg); }
      75%  { transform: translateY(-15px) rotate(5deg); }
      100% { transform: translateY(0) rotate(0deg); }
    }
    /* æŒ‡ç¤ºæ–‡ï¼šå¤§ãã‚ã®æ–‡å­—ã«å½±ä»˜ã */
    #instruction {
      font-size: 1.8em;
      margin: 20px 0;
      color: #333;
      text-shadow: 2px 2px 2px rgba(255,255,255,0.5);
    }
    /* ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤º */
    #timer {
      font-size: 1.5em;
      color: #FF5733;
      margin-bottom: 20px;
      text-shadow: 1px 1px 1px #fff;
    }
    /* æ­£è§£æ•°è¡¨ç¤º */
    #scoreDisplay {
      font-size: 1.5em;
      color: #008000;
      margin-bottom: 10px;
      text-shadow: 1px 1px 1px #fff;
    }
    /* é¢¨èˆ¹ï¼ˆãƒ–ãƒ­ãƒƒã‚¯ï¼‰é…ç½®ã‚¨ãƒªã‚¢ */
    #shapes-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 20px;
    }
    .shape {
      position: relative;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      margin: 10px;
      cursor: pointer;
      box-shadow: 0 6px 8px rgba(0,0,0,0.3);
      transition: transform 0.2s;
    }
    .shape::after {
      content: "";
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 2px;
      height: 20px;
      background: #555;
    }
    .shape:hover {
      transform: scale(1.1);
    }
    .popped {
      animation: pop 0.5s forwards;
    }
    @keyframes pop {
      0% { transform: scale(1); opacity: 1; }
      100% { transform: scale(1.5); opacity: 0; }
    }
    .result-mark {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2.5em;
      font-weight: bold;
      pointer-events: none;
    }
    /* ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ */
    #start-button {
      font-size: 1.5em;
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background-color 0.2s;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    }
    #start-button:hover {
      background-color: #45a049;
    }
    /* çµæœç”»é¢ï¼šãƒãƒƒãƒ—ã§ã‚­ãƒ©ã‚­ãƒ©æ„Ÿã®ã‚ã‚‹ãƒ‡ã‚¶ã‚¤ãƒ³ */
    .result-container {
      background: #fff;
      border: 5px dashed #FF69B4;
      border-radius: 20px;
      padding: 20px;
      animation: fadeIn 1s;
      margin-top: 20px;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }
    /* Confettiã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      opacity: 0.8;
      animation: confettiFall 3s linear forwards;
    }
    @keyframes confettiFall {
      0% { transform: translateY(-20px) rotate(0deg); }
      100% { transform: translateY(100vh) rotate(360deg); }
    }
    /* ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
    .particle {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      opacity: 0.8;
      animation: particleFade 1s ease-out forwards;
      pointer-events: none;
      z-index: 100;
    }
    @keyframes particleFade {
      0% { transform: translate(0, 0) scale(1); opacity: 0.8; }
      100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
    }
    /* é›£æ˜“åº¦é¸æŠ */
    .difficulty-container {
      margin: 20px 0;
    }
    .difficulty-btn {
      padding: 8px 16px;
      margin: 0 5px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1.2em;
      transition: all 0.2s;
    }
    .difficulty-btn.easy {
      background-color: #AAFFAA;
    }
    .difficulty-btn.normal {
      background-color: #FFFFAA;
    }
    .difficulty-btn.hard {
      background-color: #FFAAAA;
    }
    .difficulty-btn.selected {
      transform: scale(1.1);
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    /* éŸ³æ¥½ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
    .music-controls {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 100;
    }
    .music-button {
      background: rgba(255,255,255,0.7);
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      cursor: pointer;
      font-size: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    /* ãƒã‚¤ã‚¹ã‚³ã‚¢ */
    #highscore {
      font-size: 1.2em;
      color: #FF69B4;
      margin-bottom: 10px;
    }
    /* ã‚¹ãƒšã‚·ãƒ£ãƒ«ãƒœãƒ¼ãƒŠã‚¹é¢¨èˆ¹ */
    .shape.special {
      background: linear-gradient(135deg, #F9D423, #FF4E50);
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(255, 105, 180, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(255, 105, 180, 0); }
      100% { box-shadow: 0 0 0 0 rgba(255, 105, 180, 0); }
    }
    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ */
    @media (max-width: 600px) {
      #character-container {
        width: 180px;
        height: 180px;
      }
      .shape {
        width: 70px;
        height: 70px;
        margin: 5px;
      }
      #instruction {
        font-size: 1.4em;
      }
    }
  </style>
</head>
<body>
  <div class="music-controls">
    <button id="music-toggle" class="music-button">ğŸ”Š</button>
  </div>
  
  <div id="game-container">
    <!-- çŒ«ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
    <div id="character-container"></div>
    
    <!-- ãƒã‚¤ã‚¹ã‚³ã‚¢è¡¨ç¤º -->
    <div id="highscore"></div>
    
    <!-- ç¾åœ¨ã®æ­£è§£æ•°è¡¨ç¤º -->
    <div id="scoreDisplay">æ­£è§£æ•°ï¼š0</div>
    
    <!-- æŒ‡ç¤ºæ–‡ -->
    <h1 id="instruction">ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒã—ã¦ã­ï¼</h1>
    
    <!-- ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤º -->
    <div id="timer"></div>
    
    <!-- é›£æ˜“åº¦é¸æŠ -->
    <div class="difficulty-container">
      <button class="difficulty-btn easy selected" data-difficulty="easy">ã‹ã‚“ãŸã‚“</button>
      <button class="difficulty-btn normal" data-difficulty="normal">ãµã¤ã†</button>
      <button class="difficulty-btn hard" data-difficulty="hard">ã‚€ãšã‹ã—ã„</button>
    </div>
    
    <!-- é¢¨èˆ¹ï¼ˆãƒ–ãƒ­ãƒƒã‚¯ï¼‰é…ç½®ã‚¨ãƒªã‚¢ -->
    <div id="shapes-container"></div>
    
    <!-- ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ -->
    <button id="start-button">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
  </div>
  
  <!-- BGMï¼ˆãƒ«ãƒ¼ãƒ—å†ç”Ÿï¼‰ -->
  <audio id="bgm" loop>
    <source src="https://www.soundboard.com/handler/DownLoadTrack.ashx?cliptitle=Sunshine&filename=nj/NjQwNTYzNzg3_mRBVQfQKcrE.mp3" type="audio/mp3">
  </audio>
  
  <script>
    /***************************************************
     * ç©¶æ¥µã®å¯æ„›ã„çŒ«ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ï¼ˆSVGï¼‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
     * (ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ©ãƒ«ï¼ç¬‘é¡”ï¼æ³£ãé¡”ï¼è¸Šã‚‹)
     ***************************************************/
    // ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ©ãƒ«ãªçŒ«ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ï¼ˆã•ã‚‰ã«ä¸¸ãã€ãƒ–ãƒ©ãƒ¼ãƒ»ãƒãƒ¼ã‚¯ã€ãƒãƒ¼ãƒˆå‹ã®é¼»ï¼†ãƒªãƒœã‚¿ã‚¤ä»˜ãï¼‰
    const catNeutralSVG = `
<svg viewBox="0 0 250 250" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <radialGradient id="catFaceGradientUltimate" cx="50%" cy="50%" r="50%">
      <stop offset="0%" stop-color="#FFE4B5"/>
      <stop offset="100%" stop-color="#FFDAB9"/>
    </radialGradient>
    <filter id="catShadowUltimate" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="4" dy="4" stdDeviation="4" flood-color="#000" flood-opacity="0.3"/>
    </filter>
    <style>
      .blink { animation: blink 5s infinite; }
      @keyframes blink { 0%,95%,100% { opacity: 1; } 97% { opacity: 0; } }
    </style>
  </defs>
  <!-- Ears -->
  <path d="M60,80 Q80,30 100,80" fill="url(#catFaceGradientUltimate)" stroke="#000" stroke-width="3" filter="url(#catShadowUltimate)"/>
  <path d="M150,80 Q170,30 190,80" fill="url(#catFaceGradientUltimate)" stroke="#000" stroke-width="3" filter="url(#catShadowUltimate)"/>
  <!-- Face -->
  <circle cx="125" cy="140" r="60" fill="url(#catFaceGradientUltimate)" stroke="#000" stroke-width="3" filter="url(#catShadowUltimate)"/>
  <!-- Eyes -->
  <ellipse cx="95" cy="130" rx="12" ry="16" fill="#fff" stroke="#000" stroke-width="2" filter="url(#catShadowUltimate)"/>
  <ellipse cx="155" cy="130" rx="12" ry="16" fill="#fff" stroke="#000" stroke-width="2" filter="url(#catShadowUltimate)"/>
  <circle class="blink" cx="95" cy="130" r="6" fill="#000"/>
  <circle class="blink" cx="155" cy="130" r="6" fill="#000"/>
  <!-- Blushï¼ˆã»ã£ãºãŸï¼‰ -->
  <circle cx="75" cy="150" r="8" fill="pink" opacity="0.7"/>
  <circle cx="175" cy="150" r="8" fill="pink" opacity="0.7"/>
  <!-- Noseï¼ˆãƒãƒ¼ãƒˆå‹ï¼‰ -->
  <path d="M125,145 
           C120,140, 115,140, 115,145 
           C115,150, 125,160, 125,160 
           C125,160, 135,150, 135,145 
           C135,140, 130,140, 125,145 Z" fill="#FF6B6B" stroke="#000" stroke-width="2" filter="url(#catShadowUltimate)"/>
  <!-- Mouthï¼ˆå°ã•ãªã‚¹ãƒã‚¤ãƒ«ï¼‰ -->
  <path d="M110,165 Q125,175 140,165" stroke="#000" stroke-width="2" fill="none" filter="url(#catShadowUltimate)"/>
  <!-- Whiskers -->
  <line x1="60" y1="145" x2="110" y2="150" stroke="#000" stroke-width="2"/>
  <line x1="60" y1="155" x2="110" y2="155" stroke="#000" stroke-width="2"/>
  <line x1="60" y1="165" x2="110" y2="160" stroke="#000" stroke-width="2"/>
  <line x1="140" y1="150" x2="190" y2="145" stroke="#000" stroke-width="2"/>
  <line x1="140" y1="155" x2="190" y2="155" stroke="#000" stroke-width="2"/>
  <line x1="140" y1="160" x2="190" y2="165" stroke="#000" stroke-width="2"/>
  <!-- Bow Tieï¼ˆãƒªãƒœã‚¿ã‚¤ï¼‰ -->
  <rect x="105" y="165" width="40" height="15" fill="#FF69B4" stroke="#000" stroke-width="2" rx="5" ry="5" filter="url(#catShadowUltimate)"/>
  <text x="125" y="177" text-anchor="middle" font-size="10" fill="#fff">â¤</text>
</svg>
    `;
    // ç¬‘é¡”ã®çŒ«ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ï¼ˆå¤§ããªã‚¹ãƒã‚¤ãƒ«ï¼‰
    const catSmileSVG = `
<svg viewBox="0 0 250 250" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <radialGradient id="catFaceGradientSmileUltimate" cx="50%" cy="50%" r="50%">
      <stop offset="0%" stop-color="#FFE4B5"/>
      <stop offset="100%" stop-color="#FFDAB9"/>
    </radialGradient>
    <filter id="catShadowSmileUltimate" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="4" dy="4" stdDeviation="4" flood-color="#000" flood-opacity="0.3"/>
    </filter>
    <style>
      .blink { animation: blink 5s infinite; }
      @keyframes blink { 0%,95%,100% { opacity: 1; } 97% { opacity: 0; } }
    </style>
  </defs>
  <!-- Ears -->
  <path d="M60,80 Q80,30 100,80" fill="url(#catFaceGradientSmileUltimate)" stroke="#000" stroke-width="3" filter="url(#catShadowSmileUltimate)"/>
  <path d="M150,80 Q170,30 190,80" fill="url(#catFaceGradientSmileUltimate)" stroke="#000" stroke-width="3" filter="url(#catShadowSmileUltimate)"/>
  <!-- Face -->
  <circle cx="125" cy="140" r="60" fill="url(#catFaceGradientSmileUltimate)" stroke="#000" stroke-width="3" filter="url(#catShadowSmileUltimate)"/>
  <!-- Eyes -->
  <ellipse cx="95" cy="130" rx="12" ry="16" fill="#fff" stroke="#000" stroke-width="2" filter="url(#catShadowSmileUltimate)"/>
  <ellipse cx="155" cy="130" rx="12" ry="16" fill="#fff" stroke="#000" stroke-width="2" filter="url(#catShadowSmileUltimate)"/>
  <circle class="blink" cx="95" cy="130" r="6" fill="#000"/>
  <circle class="blink" cx="155" cy="130" r="6" fill="#000"/>
  <!-- Blush -->
  <circle cx="75" cy="150" r="8" fill="pink" opacity="0.7"/>
  <circle cx="175" cy="150" r="8" fill="pink" opacity="0.7"/>
  <!-- Noseï¼ˆãƒãƒ¼ãƒˆå‹ï¼‰ -->
  <path d="M125,145 
           C120,140, 115,140, 115,145 
           C115,150, 125,165, 125,165 
           C125,165, 135,150, 135,145 
           C135,140, 130,140, 125,145 Z" fill="#FF6B6B" stroke="#000" stroke-width="2" filter="url(#catShadowSmileUltimate)"/>
  <!-- å¤§ããªã‚¹ãƒã‚¤ãƒ« -->
  <path d="M110,165 Q125,195 140,165" stroke="#000" stroke-width="2" fill="none" filter="url(#catShadowSmileUltimate)"/>
  <!-- Whiskers -->
  <line x1="60" y1="145" x2="110" y2="150" stroke="#000" stroke-width="2"/>
  <line x1="60" y1="155" x2="110" y2="155" stroke="#000" stroke-width="2"/>
  <line x1="60" y1="165" x2="110" y2="160" stroke="#000" stroke-width="2"/>
  <line x1="140" y1="150" x2="190" y2="145" stroke="#000" stroke-width="2"/>
  <line x1="140" y1="155" x2="190" y2="155" stroke="#000" stroke-width="2"/>
  <line x1="140" y1="160" x2="190" y2="165" stroke="#000" stroke-width="2"/>
  <!-- Bow Tie -->
  <rect x="105" y="165" width="40" height="15" fill="#FF69B4" stroke="#000" stroke-width="2" rx="5" ry="5" filter="url(#catShadowSmileUltimate)"/>
  <text x="125" y="177" text-anchor="middle" font-size="10" fill="#fff">â¤</text>
</svg>
    `;
    // æ³£ãé¡”ã®çŒ«ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ï¼ˆã—ã‹ã‚ã£é¢ï¼‹æ¶™ï¼‰
    const catCrySVG = `
<svg viewBox="0 0 250 250" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <radialGradient id="catFaceGradientCryUltimate" cx="50%" cy="50%" r="50%">
      <stop offset="0%" stop-color="#FFE4B5"/>
      <stop offset="100%" stop-color="#FFDAB9"/>
    </radialGradient>
    <filter id="catShadowCryUltimate" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="4" dy="4" stdDeviation="4" flood-color="#000" flood-opacity="0.3"/>
    </filter>
    <style>
      .blink { animation: blink 5s infinite; }
      @keyframes blink { 0%,95%,100% { opacity: 1; } 97% { opacity: 0; } }
    </style>
  </defs>
  <!-- Ears -->
  <path d="M60,80 Q80,30 100,80" fill="url(#catFaceGradientCryUltimate)" stroke="#000" stroke-width="3" filter="url(#catShadowCryUltimate)"/>
  <path d="M150,80 Q170,30 190,80" fill="url(#catFaceGradientCryUltimate)" stroke="#000" stroke-width="3" filter="url(#catShadowCryUltimate)"/>
  <!-- Face -->
  <circle cx="125" cy="140" r="60" fill="url(#catFaceGradientCryUltimate)" stroke="#000" stroke-width="3" filter="url(#catShadowCryUltimate)"/>
  <!-- Eyes -->
  <ellipse cx="95" cy="130" rx="12" ry="16" fill="#fff" stroke="#000" stroke-width="2" filter="url(#catShadowCryUltimate)"/>
  <ellipse cx="155" cy="130" rx="12" ry="16" fill="#fff" stroke="#000" stroke-width="2" filter="url(#catShadowCryUltimate)"/>
  <circle class="blink" cx="95" cy="130" r="6" fill="#000"/>
  <circle class="blink" cx="155" cy="130" r="6" fill="#000"/>
  <!-- Blush -->
  <circle cx="75" cy="150" r="8" fill="pink" opacity="0.7"/>
  <circle cx="175" cy="150" r="8" fill="pink" opacity="0.7"/>
  <!-- Nose -->
  <path d="M125,145 
           C120,140, 115,140, 115,145 
           C115,150, 125,160, 125,160 
           C125,160, 135,150, 135,145 
           C135,140, 130,140, 125,145 Z" fill="#FF6B6B" stroke="#000" stroke-width="2" filter="url(#catShadowCryUltimate)"/>
  <!-- ã—ã‹ã‚ã£é¢ã®å£ -->
  <path d="M110,170 Q125,155 140,170" stroke="#000" stroke-width="2" fill="none" filter="url(#catShadowCryUltimate)"/>
  <!-- æ¶™ -->
  <circle cx="95" cy="140" r="6" fill="#00BFFF" opacity="0.7"/>
  <circle cx="155" cy="140" r="6" fill="#00BFFF" opacity="0.7"/>
  <!-- Whiskers -->
  <line x1="60" y1="145" x2="110" y2="150" stroke="#000" stroke-width="2"/>
  <line x1="60" y1="155" x2="110" y2="155" stroke="#000" stroke-width="2"/>
  <line x1="60" y1="165" x2="110" y2="160" stroke="#000" stroke-width="2"/>
  <line x1="140" y1="150" x2="190" y2="145" stroke="#000" stroke-width="2"/>
  <line x1="140" y1="155" x2="190" y2="155" stroke="#000" stroke-width="2"/>
  <line x1="140" y1="160" x2="190" y2="165" stroke="#000" stroke-width="2"/>
  <!-- Bow Tie -->
  <rect x="105" y="165" width="40" height="15" fill="#FFC0CB" stroke="#000" stroke-width="2" rx="5" ry="5" filter="url(#catShadowCryUltimate)"/>
  <text x="125" y="177" text-anchor="middle" font-size="10" fill="#fff">â¤</text>
</svg>
    `;
    
    // é©šãã®çŒ«ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ï¼ˆç›®ãŒå¤§ããã€å£ãŒOå‹ï¼‰
    const catSurpriseSVG = `
<svg viewBox="0 0 250 250" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <radialGradient id="catFaceGradientSurpriseUltimate" cx="50%" cy="50%" r="50%">
      <stop offset="0%" stop-color="#FFE4B5"/>
      <stop offset="100%" stop-color="#FFDAB9"/>
    </radialGradient>
    <filter id="catShadowSurpriseUltimate" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="4" dy="4" stdDeviation="4" flood-color="#000" flood-opacity="0.3"/>
    </filter>
  </defs>
  <!-- Ears -->
  <path d="M60,80 Q80,30 100,80" fill="url(#catFaceGradientSurpriseUltimate)" stroke="#000" stroke-width="3" filter="url(#catShadowSurpriseUltimate)"/>
  <path d="M150,80 Q170,30 190,80" fill="url(#catFaceGradientSurpriseUltimate)" stroke="#000" stroke-width="3" filter="url(#catShadowSurpriseUltimate)"/>
  <!-- Face -->
  <circle cx="125" cy="140" r="60" fill="url(#catFaceGradientSurpriseUltimate)" stroke="#000" stroke-width="3" filter="url(#catShadowSurpriseUltimate)"/>
  <!-- Eyes (Very Big) -->
  <ellipse cx="95" cy="130" rx="14" ry="20" fill="#fff" stroke="#000" stroke-width="2" filter="url(#catShadowSurpriseUltimate)"/>
  <ellipse cx="155" cy="130" rx="14" ry="20" fill="#fff" stroke="#000" stroke-width="2" filter="url(#catShadowSurpriseUltimate)"/>
  <circle cx="95" cy="130" r="8" fill="#000"/>
  <circle cx="155" cy="130" r="8" fill="#000"/>
  <!-- Blush -->
  <circle cx="75" cy="150" r="8" fill="pink" opacity="0.7"/>
  <circle cx="175" cy="150" r="8" fill="pink" opacity="0.7"/>
  <!-- Noseï¼ˆãƒãƒ¼ãƒˆå‹ï¼‰ -->
  <path d="M125,145 
           C120,140, 115,140, 115,145 
           C115,150, 125,160, 125,160 
           C125,160, 135,150, 135,145 
           C135,140, 130,140, 125,145 Z" fill="#FF6B6B" stroke="#000" stroke-width="2" filter="url(#catShadowSurpriseUltimate)"/>
  <!-- Oå‹ã®å£ -->
  <circle cx="125" cy="175" r="10" fill="#fff" stroke="#000" stroke-width="2" filter="url(#catShadowSurpriseUltimate)"/>
  <!-- Whiskers -->
  <line x1="60" y1="145" x2="110" y2="150" stroke="#000" stroke-width="2"/>
  <line x1="60" y1="155" x2="110" y2="155" stroke="#000" stroke-width="2"/>
  <line x1="60" y1="165" x2="110" y2="160" stroke="#000" stroke-width="2"/>
  <line x1="140" y1="150" x2="190" y2="145" stroke="#000" stroke-width="2"/>
  <line x1="140" y1="155" x2="190" y2="155" stroke="#000" stroke-width="2"/>
  <line x1="140" y1="160" x2="190" y2="165" stroke="#000" stroke-width="2"/>
  <!-- Bow Tie -->
  <rect x="105" y="165" width="40" height="15" fill="#FF69B4" stroke="#000" stroke-width="2" rx="5" ry="5" filter="url(#catShadowSurpriseUltimate)"/>
  <text x="125" y="177" text-anchor="middle" font-size="10" fill="#fff">â¤</text>
</svg>
    `;
    
    // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®è¡¨æƒ…æ›´æ–°ï¼ˆ'dance'ã®å ´åˆã¯è¸Šã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ï¼‰
    function updateCat(expression) {
      const container = document.getElementById('character-container');
      container.classList.remove('dancing');
      if(expression === 'smile'){
        container.innerHTML = catSmileSVG;
      } else if(expression === 'cry'){
        container.innerHTML = catCrySVG;
      } else if(expression === 'dance'){
        container.innerHTML = catSmileSVG;
        container.classList.add('dancing');
      } else if(expression === 'surprise'){
        container.innerHTML = catSurpriseSVG;
      } else {
        container.innerHTML = catNeutralSVG;
      }
    }
    updateCat('neutral');
    
    /******************************
     * ã‚²ãƒ¼ãƒ ç”¨å¤‰æ•°ãƒ»è¨­å®š
     ******************************/
    const COLORS = [
      { name: 'red',      label: 'èµ¤ã„',     code: '#FF5555' },
      { name: 'blue',     label: 'é’ã„',     code: '#5555FF' },
      { name: 'yellow',   label: 'é»„è‰²ã„',   code: '#FFFF55' },
      { name: 'green',    label: 'ç·‘ã®',     code: '#55FF55' },
      { name: 'purple',   label: 'ç´«ã®',     code: '#AA55FF' },
      { name: 'orange',   label: 'ã‚ªãƒ¬ãƒ³ã‚¸ã®', code: '#FFAA55' },
      { name: 'pink',     label: 'ãƒ”ãƒ³ã‚¯ã®',  code: '#FF55AA' },
      { name: 'cyan',     label: 'æ°´è‰²ã®',    code: '#55FFFF' }
    ];
    
    // åŠ¹æœéŸ³ï¼ˆã‚ªãƒ³ãƒ©ã‚¤ãƒ³éŸ³æºã«å¤‰æ›´ï¼‰
    const correctSound = new Audio('https://www.soundjay.com/buttons/sounds/button-09.mp3');
    const incorrectSound = new Audio('https://www.soundjay.com/buttons/sounds/button-10.mp3');
    const applauseSound = new Audio('https://www.soundjay.com/human/sounds/applause-01.mp3');
    const bonusSound = new Audio('https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3');
    
    // ã‚²ãƒ¼ãƒ å¤‰æ•°
    const shapesContainer = document.getElementById('shapes-container');
    const instructionEl = document.getElementById('instruction');
    const timerEl = document.getElementById('timer');
    const scoreDisplay = document.getElementById('scoreDisplay');
    const highscoreEl = document.getElementById('highscore');
    const startButton = document.getElementById('start-button');
    const bgmAudio = document.getElementById('bgm');
    const musicToggle = document.getElementById('music-toggle');
    
    let targetColor = null;
    let answered = false;
    let roundNumber = 0;
    let score = 0;
    let highScore = localStorage.getItem('catBalloonHighScore') || 0;
    let timerID = null;
    let countDownInterval = null;
    let currentDifficulty = 'easy';
    let bonusRound = false;
    let isMusicPlaying = false;
    
    // é›£æ˜“åº¦ã«é–¢ã™ã‚‹è¨­å®š
    const difficultySettings = {
      easy: {
        timeLimit: 8,
        balloonCount: 4,
        colorsToUse: 4,  // ä½¿ç”¨ã™ã‚‹è‰²ã®æ•°
        bonusChance: 0.3 // ãƒœãƒ¼ãƒŠã‚¹ãƒ©ã‚¦ãƒ³ãƒ‰å‡ºç¾ç¢ºç‡
      },
      normal: {
        timeLimit: 6,
        balloonCount: 6,
        colorsToUse: 6,
        bonusChance: 0.2
      },
      hard: {
        timeLimit: 4,
        balloonCount: 8,
        colorsToUse: 8,
        bonusChance: 0.1
      }
    };
    
    // ãƒã‚¤ã‚¹ã‚³ã‚¢è¡¨ç¤º
    highscoreEl.textContent = "ãƒã‚¤ã‚¹ã‚³ã‚¢: " + highScore;
    
    // BGMæ“ä½œ
    musicToggle.addEventListener('click', function() {
      if (isMusicPlaying) {
        bgmAudio.pause();
        musicToggle.textContent = 'ğŸ”ˆ';
        isMusicPlaying = false;
      } else {
        bgmAudio.play();
        musicToggle.textContent = 'ğŸ”Š';
        isMusicPlaying = true;
      }
    });
    
    // é›£æ˜“åº¦é¸æŠ
    const difficultyBtns = document.querySelectorAll('.difficulty-btn');
    difficultyBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        // ä»¥å‰ã®é¸æŠã‚’è§£é™¤
        difficultyBtns.forEach(b => b.classList.remove('selected'));
        // æ–°ã—ã„é¸æŠã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
        this.classList.add('selected');
        currentDifficulty = this.dataset.difficulty;
      });
    });
    
    // éŸ³å£°èª­ã¿ä¸Šã’ï¼ˆæ—¢å­˜ã®éŸ³å£°åœæ­¢ï¼‹1.5å€é€Ÿï¼‰
    function speak(text) {
      if('speechSynthesis' in window){
        speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.rate = 1.5;
        utterance.pitch = 1;
        utterance.lang = 'ja-JP';
        speechSynthesis.speak(utterance);
      }
    }
    
    // æ®‹ã‚Šæ™‚é–“ã®ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹
    function startCountdown() {
      let timeLeft = difficultySettings[currentDifficulty].timeLimit;
      timerEl.textContent = "æ®‹ã‚Šæ™‚é–“: " + timeLeft + "ç§’";
      countDownInterval = setInterval(() => {
        timeLeft--;
        if(timeLeft >= 0){
          timerEl.textContent = "æ®‹ã‚Šæ™‚é–“: " + timeLeft + "ç§’";
        }
        if(timeLeft <= 0){
          clearInterval(countDownInterval);
        }
      }, 1000);
    }
    
    // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
    function startTimer() {
      startCountdown();
      timerID = setTimeout(() => {
        if(!answered){
          instructionEl.textContent = "æ™‚é–“åˆ‡ã‚Œï¼";
          speak("æ™‚é–“åˆ‡ã‚Œï¼");
          updateCat('cry');
          clearInterval(countDownInterval);
          setTimeout(nextRound, 1000);
        }
      }, difficultySettings[currentDifficulty].timeLimit * 1000);
    }
    
    // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
    function createParticles(x, y, color) {
      const particleCount = 15;
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        particle.style.backgroundColor = color;
        particle.style.left = x + 'px';
        particle.style.top = y + 'px';
        
        // ãƒ©ãƒ³ãƒ€ãƒ ãªæ–¹å‘ã¨è·é›¢
        const angle = Math.random() * Math.PI * 2;
        const distance = 50 + Math.random() * 100;
        const tx = Math.cos(angle) * distance;
        const ty = Math.sin(angle) * distance;
        
        particle.style.setProperty('--tx', tx + 'px');
        particle.style.setProperty('--ty', ty + 'px');
        
        document.body.appendChild(particle);
        
        // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã®å‰Šé™¤
        setTimeout(() => {
          particle.remove();
        }, 1000);
      }
    }
    
    // æ¬¡ã®å•é¡Œã¸ï¼ˆå…¨5å•çµ‚äº†ã§ã‚²ãƒ¼ãƒ çµ‚äº†ï¼‰
    function nextRound() {
      clearTimeout(timerID);
      clearInterval(countDownInterval);
      
      // ãƒœãƒ¼ãƒŠã‚¹ãƒ©ã‚¦ãƒ³ãƒ‰ã®ãƒã‚§ãƒƒã‚¯
      const shouldShowBonus = !bonusRound && 
                           roundNumber > 0 && 
                           roundNumber % 3 === 0 && 
                           Math.random() < difficultySettings[currentDifficulty].bonusChance;
      
      if (shouldShowBonus) {
        bonusRound = true;
        startBonusRound();
        return;
      }
      
      bonusRound = false;
      roundNumber++;
      
      if(roundNumber > 5){
        endGame();
        return;
      }
      
      updateCat('neutral');
      shapesContainer.innerHTML = '';
      answered = false;
      scoreDisplay.textContent = "æ­£è§£æ•°ï¼š" + score;
      
      // ç¾åœ¨ã®é›£æ˜“åº¦è¨­å®šã‚’ä½¿ç”¨
      const settings = difficultySettings[currentDifficulty];
      const availableColors = COLORS.slice(0, settings.colorsToUse);
      const randomIndex = Math.floor(Math.random() * availableColors.length);
      targetColor = availableColors[randomIndex];
      
      const displayInstruction = targetColor.label + "é¢¨èˆ¹ã‚’ã‚¿ãƒƒãƒã—ã¦ã­ï¼ï¼ˆ" + roundNumber + " / 5ï¼‰";
      const speakInstruction = targetColor.label + "é¢¨èˆ¹ã‚’ã‚¿ãƒƒãƒã—ã¦ã­ï¼";
      instructionEl.textContent = displayInstruction;
      speak(speakInstruction);
      
      const shapeCount = settings.balloonCount;
      const correctShapeIndex = Math.floor(Math.random() * shapeCount);
      
      for(let i = 0; i < shapeCount; i++) {
        const shape = document.createElement('div');
        shape.classList.add('shape');
        
        let shapeColor;
        if(i === correctShapeIndex){
          shapeColor = targetColor.code;
        } else {
          const otherColors = availableColors.filter(c => c.name !== targetColor.name);
          const randomOther = otherColors[Math.floor(Math.random() * otherColors.length)];
          shapeColor = randomOther.code;
        }
        
        shape.style.backgroundColor = shapeColor;
        
        shape.addEventListener('click', function(e){
          if(shape.classList.contains('popped')) return;
          if(answered) return;
          
          // é¢¨èˆ¹ã‚’æŠ¼ã—ãŸä½ç½®ã«ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
          const rect = shape.getBoundingClientRect();
          const x = rect.left + rect.width / 2;
          const y = rect.top + rect.height / 2;
          createParticles(x, y, shapeColor);
          
          const isCorrect = (i === correctShapeIndex);
          const mark = document.createElement('span');
          mark.classList.add('result-mark');
          mark.textContent = isCorrect ? "â—‹" : "Ã—";
          shape.appendChild(mark);
          shape.classList.add('popped');
          
          if(isCorrect){
            correctSound.currentTime = 0;
            correctSound.play();
          } else {
            incorrectSound.currentTime = 0;
            incorrectSound.play();
          }
          
          if(isCorrect){
            answered = true;
            score++;
            instructionEl.textContent = "ã‚°ãƒƒãƒ‰ã‚¸ãƒ§ãƒ–ï¼";
            speak("ã‚°ãƒƒãƒ‰ã‚¸ãƒ§ãƒ–ï¼");
            updateCat('smile');
            clearTimeout(timerID);
            clearInterval(countDownInterval);
            setTimeout(nextRound, 1000);
          } else {
            instructionEl.textContent = "ã‚‚ã†ä¸€åº¦ã€" + targetColor.label + "é¢¨èˆ¹ã‚’ã‚¿ãƒƒãƒã—ã¦ã­ï¼";
            speak("ã‚‚ã†ä¸€åº¦ã€" + targetColor.label + "é¢¨èˆ¹ã‚’ã‚¿ãƒƒãƒã—ã¦ã­ï¼");
            updateCat('cry');
            setTimeout(() => { if(!answered) updateCat('neutral'); }, 1000);
            setTimeout(() => { shape.remove(); }, 700);
          }
        });
        
        shapesContainer.appendChild(shape);
      }
      
      startTimer();
    }
    
    // ãƒœãƒ¼ãƒŠã‚¹ãƒ©ã‚¦ãƒ³ãƒ‰
    function startBonusRound() {
      updateCat('surprise');
      shapesContainer.innerHTML = '';
      answered = false;
      
      instructionEl.textContent = "ãƒœãƒ¼ãƒŠã‚¹ãƒ©ã‚¦ãƒ³ãƒ‰ï¼ã™ã¹ã¦ã®é¢¨èˆ¹ã‚’ã‚¿ãƒƒãƒã—ã¦ã­ï¼";
      speak("ãƒœãƒ¼ãƒŠã‚¹ãƒ©ã‚¦ãƒ³ãƒ‰ï¼ã™ã¹ã¦ã®é¢¨èˆ¹ã‚’ã‚¿ãƒƒãƒã—ã¦ã­ï¼");
      
      bonusSound.currentTime = 0;
      bonusSound.play();
      
      const shapeCount = 5; // ãƒœãƒ¼ãƒŠã‚¹é¢¨èˆ¹ã®æ•°
      let poppedCount = 0;
      
      for(let i = 0; i < shapeCount; i++) {
        const shape = document.createElement('div');
        shape.classList.add('shape', 'special');
        
        // ãƒ©ãƒ³ãƒ€ãƒ ãªè‰²ã¨ã‚µã‚¤ã‚º
        const colorIndex = Math.floor(Math.random() * COLORS.length);
        const shapeColor = COLORS[colorIndex].code;
        shape.style.backgroundColor = shapeColor;
        
        // ã‚µã‚¤ã‚ºã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«èª¿æ•´
        const size = 70 + Math.floor(Math.random() * 40);
        shape.style.width = size + 'px';
        shape.style.height = size + 'px';
        
        shape.addEventListener('click', function(e){
          if(shape.classList.contains('popped')) return;
          
          // é¢¨èˆ¹ã‚’æŠ¼ã—ãŸä½ç½®ã«ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
          const rect = shape.getBoundingClientRect();
          const x = rect.left + rect.width / 2;
          const y = rect.top + rect.height / 2;
          createParticles(x, y, shapeColor);
          
          shape.classList.add('popped');
          correctSound.currentTime = 0;
          correctSound.play();
          
          poppedCount++;
          score++; // å„é¢¨èˆ¹ã«ã¤ã1ç‚¹
          scoreDisplay.textContent = "æ­£è§£æ•°ï¼š" + score;
          
          if(poppedCount >= shapeCount) {
            // ã™ã¹ã¦ã®é¢¨èˆ¹ã‚’ãƒãƒƒãƒ—ã—ãŸã‚‰æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸
            instructionEl.textContent = "ã™ã”ã„ï¼ãƒœãƒ¼ãƒŠã‚¹ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆï¼";
            speak("ã™ã”ã„ï¼ãƒœãƒ¼ãƒŠã‚¹ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆï¼");
            updateCat('dance');
            setTimeout(() => {
              nextRound();
            }, 1500);
          }
        });
        
        shapesContainer.appendChild(shape);
      }
    }
    
    // ã‚²ãƒ¼ãƒ çµ‚äº†æ™‚ã®å‡¦ç†
    function endGame() {
      clearTimeout(timerID);
      clearInterval(countDownInterval);
      shapesContainer.innerHTML = '';
      timerEl.textContent = '';
      
      // ãƒã‚¤ã‚¹ã‚³ã‚¢æ›´æ–°
      if(score > highScore) {
        highScore = score;
        localStorage.setItem('catBalloonHighScore', highScore);
        highscoreEl.textContent = "ãƒã‚¤ã‚¹ã‚³ã‚¢: " + highScore;
      }
      
      const resultContainer = document.createElement('div');
      resultContainer.classList.add('result-container');
      
      let resultMessage;
      if(score <= 3) {
        resultMessage = "ãŒã‚“ã°ã£ãŸã­ï¼";
      } else if(score <= 6) {
        resultMessage = "ã™ã”ã„ã­ï¼";
      } else if(score <= 9) {
        resultMessage = "ã¨ã£ã¦ã‚‚ã™ã”ã„ï¼";
      } else {
        resultMessage = "å¤©æ‰çš„ï¼ï¼";
      }
      
      resultContainer.innerHTML = `
        <h1>ãŠã—ã¾ã„ï¼</h1>
        <p>${resultMessage} ã‚ãªãŸã¯ ${score} å•æ­£è§£ã—ãŸã‚ˆï¼</p>
        <p>${score > highScore ? "æ–°è¨˜éŒ²é”æˆï¼" : "æ¬¡ã¯ã‚‚ã£ã¨é ‘å¼µã‚ã†ã­ï¼"}</p>
        <button id="play-again" style="font-size: 1.2em; padding: 8px 16px; background-color: #4CAF50; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px;">ã‚‚ã†ä¸€åº¦éŠã¶</button>
      `;
      
      difficultyBtns.forEach(btn => {
        btn.style.display = "none";
      });
      
      startButton.style.display = "none";
      instructionEl.style.display = "none";
      document.getElementById('game-container').appendChild(resultContainer);
      
      updateCat('dance');
      speak("ãŠã¤ã‹ã‚Œã•ã¾ï¼" + resultMessage);
      applauseSound.currentTime = 0;
      applauseSound.play();
      showConfetti();
      
      // ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤ãƒœã‚¿ãƒ³
      document.getElementById('play-again').addEventListener('click', function() {
        location.reload();
      });
    }
    
    // Confettiã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
    function showConfetti() {
      const colors = ['#FFC107', '#FF5722', '#8BC34A', '#03A9F4', '#E91E63', '#9C27B0', '#FFEB3B'];
      const confettiCount = 150;
      
      for(let i = 0; i < confettiCount; i++) {
        const confetti = document.createElement('div');
        confetti.classList.add('confetti');
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.left = Math.random() * window.innerWidth + 'px';
        confetti.style.top = -20 + 'px';
        
        // ã‚µã‚¤ã‚ºã‚’ã¡ã‚‡ã£ã¨ãƒ©ãƒ³ãƒ€ãƒ ã«
        const size = 5 + Math.random() * 10;
        confetti.style.width = size + 'px';
        confetti.style.height = size + 'px';
        
        // å½¢ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ï¼ˆå††ã‹å››è§’ï¼‰
        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
        
        const duration = 3 + Math.random() * 3;
        confetti.style.animationDuration = duration + 's';
        
        document.body.appendChild(confetti);
        
        setTimeout(() => {
          confetti.remove();
        }, duration * 1000);
      }
    }
    
    // ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ
    startButton.addEventListener('click', function() {
      startButton.style.display = "none";
      // é›£æ˜“åº¦é¸æŠã‚’éè¡¨ç¤º
      difficultyBtns.forEach(btn => {
        btn.style.display = "none";
      });
      
      // BGMé–‹å§‹
      if (bgmAudio.paused) {
        bgmAudio.volume = 0.5;
        bgmAudio.play()
          .then(() => {
            isMusicPlaying = true;
            musicToggle.textContent = 'ğŸ”Š';
          })
          .catch(error => {
            console.log("BGM playback prevented by browser: ", error);
          });
      }
      
      nextRound();
    });
  </script>
</body>
</html>
